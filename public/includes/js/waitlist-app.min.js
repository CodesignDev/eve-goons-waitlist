/*
* Goon Incursion Waitlist
* @Author: Samuel Grant
* @Repo: https://github.com/makeshift-eve-goons-waitlist
* @Includes: Bird-AlertJS, FrontJS
* @Updated: 2018-08-09T21:34:15.345Z
*/
function BirdAlert(o){"use strict";var i=this,t={clickToHide:!0,closeButton:!0,autoHide:!0,duration:3e4,showAnimation:"flipInX",hideAnimation:"flipOutX",inverseInsert:!1,preventDuplicate:!1,position:"top right",quantity:7,agroup:!0,width:400,zIndex:1e3,onShow:function(){},onHide:function(){}},e={"top left":{top:"90px",left:"10px",bottom:"auto",right:"auto"},"top center":{top:"90px",left:"50%",bottom:"auto",right:"auto"},"top right":{top:"90px",left:"auto",bottom:"auto",right:"10px"},"bottom left":{top:"auto",left:"10px",bottom:"10px",right:"auto"},"bottom center":{top:"auto",left:"50%",bottom:"10px",right:"0"},"bottom right":{top:"auto",left:"auto",bottom:"10px",right:"10px"}};this.element=[],this.notify=function(t){var e=!1;if(o.preventDuplicate&&i.element.find(".container-birdAlert").each(function(){$(this).find(".content-birdAlert").html()==t.msg&&$(this).hasClass(t.className)&&(e=!0)}),e)return!1;var n=$('<div class="container-birdAlert animated '+o.showAnimation+" "+(t.className||"")+'">'+(o.closeButton?'  <i class="close-birdAlert">+</i>':"")+(t.title?'  <div class="title-birdAlert">'+t.title+"</div>":"")+'  <div class="content-birdAlert">'+t.msg+"</div></div>");-1!=o.position.search("top")?(o.inverseInsert?i.element.append(n):i.element.prepend(n),o.agroup?i.element.find(".container-birdAlert").length>o.quantity&&i.element.find(".container-birdAlert:last").remove():2<=i.element.find(".container-birdAlert").length&&i.element.find(".container-birdAlert:last").remove()):(o.inverseInsert?i.element.append(n):i.element.prepend(n),o.agroup?i.element.find(".container-birdAlert").length>o.quantity&&i.element.find(".container-birdAlert:first").remove():2<=i.element.find(".container-birdAlert").length&&i.element.find(".container-birdAlert:first").remove()),o.autoHide&&setTimeout(function(){a(n)},o.duration),o.clickToHide?n.on("click",function(){a($(this))}):o.closeButton&&n.find(".close-birdAlert").on("click",function(){a(n)}),o.onShow()};var a=function(t){t.removeClass(o.showAnimation).addClass(o.hideAnimation),t.one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){o.onHide(),t.remove()})};this.setDefaults=function(){o=$.extend({},o,t,"object"==typeof t&&t),i.element.css(e[o.position]),i.element.css({width:o.width+"px"}),"top center"==o.position||"bottom center"==o.position?i.element.css({"margin-left":"-"+o.width/2+"px"}):i.element.css({"margin-left":"0"}),i.element.css({"z-index":o.zIndex})},this.set=function(t){o=$.extend({},o,t,"object"==typeof t&&t),i.element.css(e[o.position]),i.element.css({width:o.width+"px"}),"top center"==o.position||"bottom center"==o.position?i.element.css({"margin-left":"-"+o.width/2+"px"}):i.element.css({"margin-left":"0"}),i.element.css({"z-index":o.zIndex})},o=$.extend({},t,o,"object"==typeof o&&o),i.element=$('<div class="birdAlert" style="position: fixed;"></div>'),$("body").append(i.element),i.element.css(e[o.position]),i.element.css({width:o.width+"px"}),"top center"==o.position||"bottom center"==o.position?i.element.css({"margin-left":"-"+o.width/2+"px"}):i.element.css({"margin-left":"0"}),i.element.css({"z-index":o.zIndex})}function showInfo(t){$.ajax({type:"POST",url:"/esi/ui/info/"+t})}function setWaypoint(t){$.ajax({type:"POST",url:"/esi/ui/waypoint/"+t})}function openMarket(t){$.ajax({type:"POST",url:"/esi/ui/market/"+t})}function openSearch(){document.getElementById("pilotSearchOverlay").style.display="block",$(".navbar").attr("style","display: none !important;"),$("#pilotSearchName").focus()}function closeSearch(){document.getElementById("pilotSearchOverlay").style.display="none",$(".navbar").removeAttr("style")}function hideBanner(t){$.ajax({type:"POST",url:"/internal-api/banner/:"+t}).done(function(){$("#topbanner").hide()}).fail(function(t){console.log(t.responseText)})}function sideNav(){$.ajax({type:"POST",url:"/internal-api/account/navbar"}).fail(function(t){console.log("Error updating side bar: "+t)})}function enableNotifications(){Notify.needsPermission&&Notify.isSupported()&&Notify.requestPermission(function(){$("#noNotify").hide(),null!==payloadData&&showNotification(payloadData)},function(){console.warn("Permission has been denied by the user")})}function showNotification(t){new Notify(t.data.appName,{body:t.data.message,icon:t.data.imgUrl,tag:t.data.target.id,timeout:30,notifyClick:function(){window.location.assign(t.data.comms.url)},notifyShow:function(){new Audio(t.data.sound).play()}}).show()}function setFC(t){$.ajax({type:"POST",url:"/commander/"+t+"/update/commander"}).done(function(){pollFleetInfo(t)}).fail(function(t){console.log("Error updating the backseat: ",t)})}function setBackseat(t){$.ajax({type:"POST",url:"/commander/"+t+"/update/backseat"}).done(function(){pollFleetInfo(t)}).fail(function(t){console.log("Error updating the backseat: ",t)})}function setCommsChannel(t,e,n){$.ajax({type:"POST",url:"/commander/"+t+"/update/comms",data:{name:n,url:e}}).done(function(){pollFleetInfo(t)}).fail(function(t){console.log("Error updating comms information: ",t)})}function setFleetStatus(t,e){$.ajax({type:"POST",url:"/commander/"+t+"/update/status",data:{status:e}}).done(function(){pollFleetInfo(t)}).fail(function(t){console.log("Error updating fleet status: ",t)})}function setFleetType(t,e){$.ajax({type:"POST",url:"/commander/"+t+"/update/type",data:{type:e}}).done(function(){pollFleetInfo(t)}).fail(function(t){console.log("Error updating fleet type: ",t)})}function pollFleetInfo(t){$.ajax({type:"POST",url:"/commander/"+t+"/update/info",success:function(t){$("#fcBoss").text(t.fc.name).attr("onclick","showInfo("+t.fc.characterID+")"),$("#fcBackseat").text(t.backseat.name).attr("onclick","showInfo("+t.backseat.characterID+")"),$("#status").text(t.status),$("#type").text(t.type),$("#comms").text(t.comms.name).attr("href",t.comms.url),$("#fleetSystem").text(t.location.name).attr("onclick","setWaypoint("+t.location.systemID+")")}}).fail(function(t){console.log("Failed to update the fleet info panel")})}function invitePilot(e,t){Number($("#fleetWaitlistCount").text());$("#row-"+e).removeClass().addClass("invite-pending"),$.ajax({type:"POST",url:"/commander/admin/invite/"+e+"/"+t}).done(function(){$("#row-"+e).removeClass().addClass("invite-sent"),$("#fleetWaitlistCount").text(Number($("#fleetWaitlistCount").text())-1)}).fail(function(t){$("#row-"+e).removeClass().addClass("invite-failed"),$("#"+e+"-status").text(t.responseText)})}function removePilot(t){$.ajax({type:"POST",url:"/commander/admin/remove/"+t}).done(function(){$("#row-"+t).removeClass().addClass("invite-failed"),setTimeout(function(){$("#fleetWaitlistCount").text(Number($("#fleetWaitlistCount").text())-1),$("#row-"+t).remove()},5e3)})}function alarmUser(e,t){$.ajax({type:"POST",url:"/commander/admin/alarm/"+e+"/"+t,datatype:"HTML",success:function(t){setTimeout(function(){$("#row-"+e).removeClass().addClass("invite-pending")},0),setTimeout(function(){$("#row-"+e).removeClass()},2500)}}).fail(function(t){console.log("Faied to alarm user: ",t)})}function pollPilotsInFleet(t){$.ajax({type:"GET",url:"/internal-api/fleet/"+t+"/members"}).done(function(t){$("#fleetPilotsTable").empty();for(var e=0;e<t.length;e++){var n="<tr id='row-"+t[e].pilot.characterID+"'>";n+="<td>",n+="<img src='https://image.eveonline.com/Character/"+t[e].pilot.characterID+"_64.jpg' style='height:75%' alt='avatar'> ",n+="</td>",n+="<td>",n+="<a href='javascript:void(0);' onclick='showInfo("+t[e].pilot.characterID+")'>"+t[e].pilot.name+"</a>",n+="</td>",n+="<td>",n+="<div class='dropdown'>",n+="<button class='btn btn-info btn-sm dropdown-toggle' data-toggle='dropdown' aria-expanded='false' type='button'><i class='fas fa-caret-circle-down' style='margin-right:-50%'></i></button>",n+="<div class='dropdown-menu' role='menu'>",n+="<a class='dropdown-item' href='/commander/"+t[e].pilot.name.replace(" ","-")+"/profile'>View Pilot Profile</a>",n+="<a class='dropdown-item' href='/commander/"+t[e].pilot.name.replace(" ","-")+"/skills'>View Pilot Skills</a>",n+="</div>",n+="</div>",n+="</td>",n+="<td>",n+="<button class='btn btn-danger btn-sm disabled' onclick='removePilot()'><i class='fa fa-minus'></i></button>",n+="</td>",n+="<td>",n+="<img src='https://image.eveonline.com/Render/"+t[e].activeShip+"_32.png' alt='Active Ship'>",n+="</td>",n+="<td>",n+="</td>",n+="<td>",n+="<a href='javascript:void(0);' onclick='setWaypoint("+t[e].system.systemID+")'>"+t[e].system.name+"</a></td>",n+="</td>",n+="<td>"+t[e].joined+"</td>",n+="</tr>",$("#fleetPilotsTable").prepend(n),$("#numMembers").text(t.length)}}).fail(function(t){console.log(t)})}function updateQueue(){$.ajax({type:"GET",url:"/internal-api/waitlist/get-pilot-position"}).done(function(t){console.log(t),null!==t.position?($("#queueInfo").removeClass("hide"),$("#queueInfoYourPos").text(t.position+" out of "+t.count),$("#queueInfoYourMain").text("### TODO")):$("#queueInfo").addClass("hide")}).fail(function(t){console.log(t)})}function getFleetList(){$.ajax({type:"POST",url:"/internal-api/fleets"}).done(function(t){if($("#fleetInfoCards").empty(),$("#waitlistCards").addClass("hide"),0<t.length){$("#noFleetBanner").addClass("hide"),$("#waitlistCards").removeClass("hide");for(var e=0;e<t.length;e++){var n='<div id="fleetInfoCards" class="col-lg-6 col-md-12">';n+='<div class="statistic-block block">',n+='<div class="title">',n+="<strong>Fleet Info</strong>",n+="</div>",n+='<table class="table table-striped table-sm noselect">',n+="<tbody>",n+="<tr>",n+='<td  class="tw60per">Fleet Commander:</td>',n+='<td><a href="javascript:void(0);" onclick="showInfo('+t[e].fc.characterID+')">'+t[e].fc.name+"</a></td>",n+="</tr>",n+="<tr>",n+="<td>Secondary Fleet Commander:</td>",n+='<td><a href="javascript:void(0);" onclick="showInfo('+t[e].backseat.characterID+')">'+t[e].backseat.name+"</a></td>",n+="</tr>",n+="<tr>",n+="<td>Fleet Type:</td>",n+="<td>"+t[e].type+"</td>",n+="</tr>",n+="<tr>",n+="<td>Fleet Status:</td>",n+="<td>"+t[e].status+"</td>",n+="</tr>",n+="<tr>",n+="<td>Fleet Size:</td>",n+="<td>"+t[e].size+"</td>",n+="</tr>",n+="<tr>",n+="<td>Fleet Location:</td>",n+='<td><a href="javascript:void(0)" onclick="setWaypoint('+t[e].location.systemID+')">'+t[e].location.name+"</a></td>",n+="</tr>",n+="<tr>",n+="<td>Fleet Comms:</td>",n+='<td><a href="'+t[e].comms.url+'">'+t[e].comms.name+"</a></td>",n+="</tr>",n+="</tbody>",n+="</table>",n+="</div>",$("#fleetInfoCards").append(n)}}else $("#noFleetBanner").removeClass("hide")}).fail(function(t){console.log(t)})}$(function(){if($("input.input-material").on("focus",function(){$(this).siblings(".label-material").addClass("active")}),$("input.input-material").on("blur",function(){$(this).siblings(".label-material").removeClass("active"),""!==$(this).val()?$(this).siblings(".label-material").addClass("active"):$(this).siblings(".label-material").removeClass("active")}),$(".dropdown").on("show.bs.dropdown",function(){$(this).find(".dropdown-menu").first().stop(!0,!0).fadeIn(100).addClass("active")}),$(".dropdown").on("hide.bs.dropdown",function(){$(this).find(".dropdown-menu").first().stop(!0,!0).fadeOut(100).removeClass("active")}),$(".search-open").on("click",function(t){t.preventDefault(),$(".search-panel").fadeIn(100)}),$(".search-panel .close-btn").on("click",function(){$(".search-panel").fadeOut(100)}),$(".sidebar-toggle").on("click",function(){$(this).toggleClass("active"),$("#sidebar").toggleClass("shrinked"),$(".page-content").toggleClass("active"),$(".sidebar-toggle").hasClass("active")?($(".navbar-brand .brand-sm").addClass("visible"),$(".navbar-brand .brand-big").removeClass("visible"),$(this).find("i").attr("class","fa fa-long-arrow-right")):($(".navbar-brand .brand-sm").removeClass("visible"),$(".navbar-brand .brand-big").addClass("visible"),$(this).find("i").attr("class","fa fa-long-arrow-left"))}),0<$("#style-switch").length){var t=$("link#theme-stylesheet");$("<link id='new-stylesheet' rel='stylesheet'>").insertAfter(t);var e=$("link#new-stylesheet");$.cookie("theme_csspath")&&e.attr("href",$.cookie("theme_csspath")),$("#colour").change(function(){if(""!==$(this).val()){var t="css/style."+$(this).val()+".css";e.attr("href",t),$.cookie("theme_csspath",t,{expires:365,path:document.URL.substr(0,document.URL.lastIndexOf("/"))})}return!1})}}),$(document).ready(function(){$("#searchForm").submit(function(t){t.preventDefault(),$.ajax({type:"POST",url:"/search",data:$("#searchForm").serialize()}).done(function(t){t.url&&window.location.assign(t.url)}).fail(function(t){$("#pilotSearchName").val("").attr("placeholder",t.responseText).focus(),$("#searchButton").empty().append('<i class="fa fa-search"></i>')})})}),$(document).ready(function(){$("#bannerMessage").submit(function(t){t.preventDefault()})}),$(document).ready(function(){$('[data-toggle="tooltip"]').tooltip()}),$(document).ready(function(){if(Notify.needsPermission&&Notify.isSupported()){'<i class="fas fa-bell-slash"></i> Notifications disabled: this means you may miss your invite. Click <span style="text-decoration:underline" onclick="enableNotifications()">HERE</span> to enable them.',"</div>",$("#alertarea").prepend('<div role="alert" id="noNotify" class="alert alert-primary global-banner-inactive"><i class="fas fa-bell-slash"></i> Notifications disabled: this means you may miss your invite. Click <span style="text-decoration:underline" onclick="enableNotifications()">HERE</span> to enable them.</div>')}});